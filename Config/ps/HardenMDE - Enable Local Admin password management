# Enable Local Admin password management
if ((Get-ChildItem -Path 'HKLM:\SOFTWARE\Policies\').Name -notcontains "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft Services"){
    New-Item -Path 'HKLM:\SOFTWARE\Policies' -Name 'Microsoft Services'
    New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services' -Name 'AdmPwd'
    New-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' -Name 'AdmPwdEnabled' -Value "1" -PropertyType DWORD -Force}
elseif ((Get-ChildItem -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services').Name -notcontains "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft Services\AdmPwd"){
    New-Item -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services' -Name 'AdmPwd'
    New-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' -Name 'AdmPwdEnabled' -Value "1" -PropertyType DWORD -Force}
elseif (-not $(Get-ItemProperty -Path "Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft Services\AdmPwd").AdmPwdEnabled){
    New-ItemProperty -Path 'HKLM:\SOFTWARE\Policies\Microsoft Services\AdmPwd' -Name 'AdmPwdEnabled' -Value "1" -PropertyType DWORD -Force}
else {}
